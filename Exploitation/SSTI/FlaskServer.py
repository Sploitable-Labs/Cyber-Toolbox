from flask import *

app = Flask(__name__)

html_sample = """
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />

    <title>
      
      Jinja2 exploitation
      
    </title>

    <link rel="stylesheet" href="/static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/base.css">

    
  </head>

  <body class="">
    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="/">
     Jinja2 exploitation
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
    aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" href="/">Home
          <span class="sr-only">(current)</span>
        </a>
      </li>
    </ul>
    
    <ul class="navbar-nav my-auto">
      <li class="nav-item">
        <a class="nav-link navbar-text" href="/user/register">Create account</a>
      </li>
      <li class="nav-item">
        <a class="nav-link navbar-text" href="/user/login">Log in</a>
      </li>
    </ul>
    
  </div>
</nav>

    <header></header>

    <main role="main">
      
      
      

      
<div class="container-narrow">
  <h1 class="mt-5">Create account</h1>
  <br/>

  <form class="form form-register" method="POST" action="" role="form">
    

<div class="form-group has-error">
  <div class="form-group">
    <label for="email">Email</label>
    <input class="form-control" id="email" name="email" placeholder="Email" required type="text" value="{{g.__class__}}@f.uk">
    
      
      <p class="help-block">Email {} already registered. Please log in <a href="/user/login">here</a>.</p>
      
    </div>

</div>


    

<div class="form-group ">
  <div class="form-group">
    <label for="password">Password</label>
    <input class="form-control" id="password" name="password" placeholder="Password" required type="password" value="">
    </div>

</div>


    

<div class="form-group ">
  <div class="form-group">
    <label for="confirm">Verify password</label>
    <input class="form-control" id="confirm" name="confirm" placeholder="Password (again)" required type="password" value="">
    </div>

</div>


    <p><input class="btn btn-primary" type="submit" value="Register"></p>
  </form>
</div>

    </main>

    <script src="/static/jquery-3.4.1.min.js"></script>
    <script src="/static/bootstrap/js/bootstrap.min.js"></script>
    
    
  </body>
</html>
"""

def validate_input(input):
    result = "clean"

    if len(input) > 50:
        result = "Error: Max email length is 50 characters."

    return input + "\n\n" + result


@app.route("/user/register", methods = ['GET', 'POST'])
def home():
    email = ""

    if request.method == 'GET':
        if request.args.get('email'):
            email = request.args.get('email')
        else:
            return "No email address found"

    if request.method == 'POST':
        if request.form.get('email'):
            email = request.form.get('email')
        else:
            return "No email address found"

    #result = validate_input(email)
    result = "clean"

    if result == "clean":
        result = render_template_string(email)
        return html_sample.format(result)
    else:
        return result


@app.route("/test", methods = ['GET', 'POST'])
def test():
    # if request.files.get('file'):
    #     return "found"
    # else:
    #     return "not found"

    result = render_template_string(request.form.get('email'))
    return result


if __name__ == "__main__":
    app.run(debug=True)
